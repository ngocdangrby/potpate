var generator_required=[];window.et_panel=window.et_panel||{},function(a){a(document).ready(function(a){var b={generator_section_child_change:function(a){a.prop("checked")?a.parents(".opt-section").find("input:not(.input-section)").prop("checked",!0):a.parents(".opt-section").find("input:not(.input-section)").prop("checked",!1)},generator_subsection_child_change:function(a){a.prop("checked")?a.parents(".opt-subsection").find("input:not(.has-subsection)").prop("checked",!0):a.parents(".opt-subsection").find("input:not(.has-subsection)").prop("checked",!1)},generator_parent_change:function(a){a.prop("checked")&&(a.closest(".has-subsection").find(".opt-item").first().find("input").prop("checked",!0),a.closest(".opt-section.has-subsection").find(".opt-item").first().find("input").prop("checked",!0))},generator_remove_file:function(b){confirm("Are you sure? ")&&a.ajax({method:"POST",url:ajaxurl,dataType:"JSON",data:{action:"et_panel_ajax",type:"css",action_type:"et_generator_remover"},success:function(b){"success"==b.status?(a(".css_generator-info").html(""),a(".css_generator-info").html(b.response.html).addClass("no-file-generated")):alert(b.response.msg)},error:function(){alert("ajax error")}})},generator_calc:function(a){et_panel.generator_calc_system_files(a),et_panel.generator_set_counter()},generator_generate_file:function(b,c){c.preventDefault();var d=b.serializeArray(),e="",f=[],g=a(".et_panel-popup");a.each(d,function(b,c){if(c.value.includes(",")){var d=c.value.split(",");a.each(d,function(a,b){f.includes(b)||(f.push(b),e+=b+",")})}else e+=c.value+","}),e=e.slice(0,-1),g.html('<div class="et-loader ">\t\t\t\t\t<svg class="loader-circular" viewBox="25 25 50 50">\t\t\t\t\t<circle class="loader-path" cx="50" cy="50" r="12" fill="none" stroke-width="2" stroke-miterlimit="10"></circle>\t\t\t\t\t</svg>\t\t\t\t</div>'),a("body").addClass("et_panel-popup-on"),a.ajax({method:"POST",url:ajaxurl,dataType:"JSON",data:{action:"et_panel_ajax",modules:e,type:b.attr("type"),action_type:"et_generator"},success:function(b){g.html(""),g.addClass("loading"),g.prepend('<span class="et_close-popup et-button-cancel et-button"><i class="et-admin-icon et-delete"></i></span>'),g.addClass("panel-popup-import").append(b.response.icon),g.append(b.response.msg),g.append(b.response.btn),g.addClass("active").removeClass("loading"),"success"==b.status&&(a(".css_generator-info").html(""),a(".css_generator-info").html("<h2>Latest generated file:</h2><p><strong>File location: </strong>"+b.response.data.path+"</p><p><strong>File size: </strong>"+b.response.data.size+'</p><span class="et-css-remove et-generated-remove"><span class="dashicons dashicons-trash"></span>Remove</span>').removeClass("no-file-generated"))},error:function(){alert("ajax error")}})},generator_set_counter:function(b){var c=0,d=0,e=a(".etheme-generator-head .counter-size"),f=a(".etheme-generator-head .counter-value"),g=a(".etheme-generator-head .counter-value-percent"),h=parseInt(e.data("max_size")),i=parseInt(e.data("stroke-dasharray-start")),j=parseInt(e.data("stroke-dasharray-end")),k=a(".etheme-generator-footer button");a(".etheme-css-generator .et_generator-form input:not(.has-subsection):checked").each(function(b,e){d++,a(e).attr("data-size")&&(c=parseFloat(parseFloat(c)+parseFloat(a(e).attr("data-size"))).toFixed(1))}),d>1?k.removeClass("et-button-dark-grey").addClass("et-button-green").removeAttr("disabled"):k.removeClass("et-button-green").addClass("et-button-dark-grey").attr("disabled",1),f.text("~"+c+"Kb");var l=c/h*100;l=l.toFixed(1),l=l>100?100:l,l="~"+l+"%",g.text(l),a(e).css("strokeDasharray",c/h*i+"px "+j+"px"),a(".etheme-page-content").addClass("primary-counted")},generator_calc_system_files:function(b){var c=a(".opt-section.required"),d=c.find(".size-value"),e=d.attr("data-size"),f=c.find(".input-section");if(b&&!b.prop("checked")){if(b.attr("data-required")){var g=JSON.parse(b.attr("data-required"));a.each(g,function(a,b){generator_required.includes(a)&&(generator_required.splice(a,1),e=parseFloat(parseFloat(e)-parseFloat(b)).toFixed(1),d.html(e),d.attr("data-size",e),f.find("input").attr("data-size",e))})}et_panel.generator_calc_section(b,!1)}else b&&et_panel.generator_calc_section(b,!0);a(".etheme-css-generator .et_generator-form input:checked").each(function(b,f){if(a(".etheme-page-content").hasClass("primary-counted")||et_panel.generator_calc_section(a(f),!0),a(f).attr("data-required")){var g=JSON.parse(a(f).attr("data-required"));a.each(g,function(a,b){generator_required.includes(a)||(generator_required.push(a),e=parseFloat(parseFloat(e)+parseFloat(b)).toFixed(1),d.html(e),d.attr("data-size",e),c.find("input").attr("data-size",e))})}})},generator_calc_section:function(b,c){if(!b.parents(".opt-section").hasClass("required")){var d=b.closest(".opt-section"),e=d.find(".real-size").first().attr("data-size"),f=b.closest(".opt-subsection.has-subsection"),g=f.find(".real-size").attr("data-size"),h=0,i=0;if(b.hasClass("has-subsection")&&a(".etheme-page-content").hasClass("primary-counted"))if(c){var j=d.find(".opt-subsection.has-subsection input.has-subsection").parent();a.each(j,function(){var b=a(this).find(".real-size"),c=a(this).find(".size-value").attr("data-size");b.html(c).attr("data-size",c)}),h=b.attr("data-size"),b.closest(".opt-item").find(".real-size").html(h).attr("data-size",h),i=parseFloat(parseFloat(e)+parseFloat(b.attr("data-size"))).toFixed(1)}else{h=0;var j=d.find(".opt-subsection.has-subsection input.has-subsection").parent();a.each(j,function(){a(this).find(".real-size").html(0).attr("data-size",0)}),i=parseFloat(parseFloat(e)-parseFloat(b.attr("data-size"))).toFixed(1),b.closest(".opt-item").find(".real-size").html(h).attr("data-size",h)}else{if(b.hasClass("has-subsection"))return;c?(h=parseFloat(parseFloat(g)+parseFloat(b.attr("data-size"))).toFixed(1),i=parseFloat(parseFloat(e)+parseFloat(b.attr("data-size"))).toFixed(1)):(h=parseFloat(parseFloat(g)-parseFloat(b.attr("data-size"))).toFixed(1),i=parseFloat(parseFloat(e)-parseFloat(b.attr("data-size"))).toFixed(1))}(h<0||isNaN(h))&&(h=0),(i<0||isNaN(i))&&(i=0),f.find(".real-size").html(h).attr("data-size",h),d.find(".real-size").first().html(i).attr("data-size",i)}}};window.et_panel=Object.assign(window.et_panel,b);var c={1:{selector:".opt-section.has-subsection input.input-section.has-subsection",type:"change",callback:et_panel.generator_section_child_change},2:{selector:".opt-subsection.has-subsection input.has-subsection",type:"change",callback:et_panel.generator_subsection_child_change},3:{selector:".opt-item input",type:"change",callback:et_panel.generator_parent_change},4:{selector:".et-css-remove",type:"click",callback:et_panel.generator_remove_file},5:{selector:".etheme-css-generator .et_generator-form input",type:"change",callback:et_panel.generator_calc},6:{selector:".etheme-css-generator .et_generator-form input",type:"ready",callback:et_panel.generator_calc},7:{selector:"form.et_generator-form",type:"submit",callback:et_panel.generator_generate_file}};a.each(c,function(b,c){"ready"==c.type?a(document).ready(function(b){c.callback(a(this),b)}):a(document).on(c.type,c.selector,function(b){c.callback(a(this),b)})})})}(jQuery,window.et_panel);